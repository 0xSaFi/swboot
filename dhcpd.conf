ddns-update-style none;

default-lease-time 600;
max-lease-time 3600;

# Do not disturb clients that happen to temporary be on this network
not authoritative;
log-facility local7;

# Set filename, it will cause one single download from DHCP which will
# bring the switch to minimalistic dhtech base config.
# When a DHCP request is accepted it will spawn a SNMP configuration set
# process that will tell the switch to download configuration from TFTP.
next-server 192.168.20.10;
filename "network-confg";

on commit {
  set agentType = binary-to-ascii(10, 8, "", substring(option agent.circuit-id, 0, 1));
  set agentLength = binary-to-ascii(10, 8, "", substring(option agent.circuit-id, 1, 1));
  if agentType = "0" {
    set swName = binary-to-ascii(16, 8, ":", substring(option agent.circuit-id, 4, 2));
  } else {
    set swName = substring(option agent.circuit-id, 2, 10);
  }
  set swIp = binary-to-ascii(10, 8, ".", leased-address);
  set swClient = substring (option dhcp-client-identifier, 1, 5);
  set swRelay = binary-to-ascii(10, 8, ".", packet(24,4));
  execute("/srv/swboot/dhcp-hook.py", "commit", swIp, swName, swClient, swRelay);
}

class "cisco-switch" {
  match if (substring (option dhcp-client-identifier, 1, 5) = "cisco");
}

subnet 192.168.0.0 netmask 255.255.252.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.1.10  192.168.3.250;
    option routers 192.168.0.1;
  }
}

subnet 192.168.4.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.4.10  192.168.4.250;
    option routers 192.168.4.1;
  }
}

subnet 192.168.5.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.5.10  192.168.5.250;
    option routers 192.168.5.1;
  }
}

subnet 192.168.6.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.6.10  192.168.6.250;
    option routers 192.168.6.1;
  }
}

subnet 192.168.7.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.7.10  192.168.7.250;
    option routers 192.168.7.1;
  }
}

subnet 192.168.8.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.8.10  192.168.8.250;
    option routers 192.168.8.1;
  }
}

subnet 192.168.9.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.9.10  192.168.9.250;
    option routers 192.168.9.1;
  }
}

subnet 192.168.10.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.10.10  192.168.10.250;
    option routers 192.168.10.1;
  }
}

subnet 192.168.11.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.11.10  192.168.11.250;
    option routers 192.168.11.1;
  }
}

subnet 192.168.12.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.12.10  192.168.12.250;
    option routers 192.168.12.1;
  }
}

subnet 192.168.13.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.13.10  192.168.13.250;
    option routers 192.168.13.1;
  }
}

subnet 192.168.14.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.14.10  192.168.14.250;
    option routers 192.168.14.1;
  }
}

subnet 192.168.15.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.15.10  192.168.15.250;
    option routers 192.168.15.1;
  }
}

subnet 192.168.16.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.16.10  192.168.16.250;
    option routers 192.168.16.1;
  }
}

subnet 192.168.17.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.17.10  192.168.17.250;
    option routers 192.168.17.1;
  }
}

subnet 192.168.18.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.18.10  192.168.18.250;
    option routers 192.168.18.1;
  }
}

subnet 192.168.19.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.19.10  192.168.19.250;
    option routers 192.168.19.1;
  }
}

subnet 192.168.20.0 netmask 255.255.255.0 {
  pool {
    allow members of "cisco-switch";
    range 192.168.20.50  192.168.20.250;
    option routers 192.168.20.1;
  }
}

